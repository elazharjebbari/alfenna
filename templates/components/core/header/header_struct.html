{% load static atelier_utils %}

<div class="header-section" data-ab-variant="{{ variant_key|default:'A' }}">

  {% if topbar.enabled %}
  <div class="header-top d-none d-lg-block">
    <div class="container" style="padding-top:6px;padding-bottom:6px;">
      <div class="header-top-wrapper" style="display:flex;align-items:center;gap:16px;">
        <div class="header-top-left" style="flex:1;">
          <p class="m-0" style="margin:0;">
            {% render_string topbar.text_html %}
            {% if topbar.deadline_ts %}
              • <span id="tb-timer" data-deadline="{{ topbar.deadline_ts }}" style="font-weight:700;"></span>
            {% endif %}
            {% if topbar.cta %}
              • <a href="{{ topbar.cta.url }}" style="color:#4ade80;text-decoration:underline;">{{ topbar.cta.label }}</a>
            {% endif %}
          </p>
        </div>

        <!-- Médaille contact gardée mais discrète -->
        <div class="header-top-medal" style="opacity:.85;">
          <div class="top-info" style="display:flex;gap:16px;">
            {% if contact.phone_tel and contact.phone_display %}
              <p style="margin:0;"><i class="flaticon-phone-call"></i> <a href="tel:{{ contact.phone_tel }}" style="color:#ddd;text-decoration:none;">{{ contact.phone_display }}</a></p>
            {% endif %}
            {% if contact.email %}
              <p style="margin:0;"><i class="flaticon-email"></i> <a href="mailto:{{ contact.email }}" style="color:#ddd;text-decoration:none;">{{ contact.email }}</a></p>
            {% endif %}
          </div>
        </div>

        <!-- On masque les socials desktop pour focus conversion -->
        <div class="header-top-right" style="display:none;"></div>
      </div>
    </div>
  </div>
  {% endif %}

  <div class="header-main">
    {% if banner.enabled %}
      {% with colors=banner.colors speed_ms=banner.speed_ms pattern=banner.pattern messages=banner.messages enabled=banner.enabled %}
        {% include "components/core/header/banner_ticker/banner_ticker.html" %}
      {% endwith %}
    {% endif %}
    <div class="container">
      {{ children.header_struct__main|default_if_none:""|safe }}
    </div>
  </div>
</div>

{{ children.header_struct__mobile|default_if_none:""|safe }}

<!-- Sticky CTA mobile (toujours visible) -->
<!--<div class="d-lg-none" style="position:fixed;left:50%;transform:translateX(-50%);bottom:12px;z-index:1055;width:min(92vw,640px);">-->
<!--  <a href="#cta-buy" id="stickyCtaMobile"-->
<!--     data-ev="header_cta_click" data-ev-loc="mobile-sticky"-->
<!--     style="display:block;text-align:center;background:#198754;color:#fff;border-radius:14px;padding:12px 16px;text-decoration:none;box-shadow:0 10px 24px rgba(25,135,84,.35);">-->
<!--    <span style="font-weight:800;">Je me lance</span>-->
<!--    <small style="display:block;opacity:.95;">Paiement sécurisé • Accès immédiat</small>-->
<!--  </a>-->
<!--</div>-->

<!-- Timer JS (léger, inline) -->
{% if topbar.enabled and topbar.deadline_ts %}
<script>
(function(){
  var el = document.getElementById('tb-timer');
  if (!el) return;
  var iso = el.getAttribute('data-deadline');
  if (!iso) return;
  function two(n){return n<10?'0'+n:n;}
  function tick(){
    var end = Date.parse(iso);
    var now = Date.now();
    var diff = end - now;
    if (isNaN(end)) { el.textContent=''; return; }
    if (diff <= 0){ el.textContent='0j 00:00:00'; clearInterval(iv); return; }
    var d = Math.floor(diff/86400000);
    var h = Math.floor((diff%86400000)/3600000);
    var m = Math.floor((diff%3600000)/60000);
    var s = Math.floor((diff%60000)/1000);
    el.textContent = (d>0? (d+'j '):'')+two(h)+':'+two(m)+':'+two(s);
  }
  var iv = setInterval(tick, 1000);
  tick();
})();
</script>
{% endif %}
