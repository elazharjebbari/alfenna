{% load static safe_url %}
{% safe_url 'accounts:register' as register_url %}
{% safe_url 'accounts:login' as login_url %}

<ul class="header-auth-links">
  {% if request.user.is_authenticated %}
    <li>{{ user.username }}</li>

    <li class="dropdown" style="position: relative;">
      <a href="#" class="dropdown-toggle"><i class="fas fa-user-check text-success"></i></a>
      <ul class="dropdown-menu dropdown-menu-end">
        <li>
          <a class="dropdown-item" href="#"
             onclick="event.preventDefault(); document.getElementById('logout-form').submit();">
            <i class="fas fa-sign-out-alt"></i> Se déconnecter
          </a>
        </li>
      </ul>
    </li>

    {# <<< ICI: form hidden pour POST #}
    <form id="logout-form" method="post" action="{% url 'accounts:logout' %}" style="display:none;">
      {% csrf_token %}
    </form>

  {% else %}
    {# Ouvre le modal de login si présent, sinon fallback lien classique #}
    <li>
      <a class="nav-link"
         href="{{ login_url }}?next={{ request.get_full_path|urlencode }}"
         data-bs-toggle="modal" data-bs-target="#loginModal">
        <i class="fas fa-sign-in-alt"></i> Se connecter
      </a>
    </li>
    <li><a class="nav-link" href="{{ register_url }}">S'inscrire</a></li>
  {% endif %}
</ul>
