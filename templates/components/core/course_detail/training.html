{% load atelier_utils atelier_images %}
<div class="courses-details">
  <div class="courses-details-images">
    {% with hero=hero_image_url|default:"" %}
      {% if hero|slice:":4" == "http" %}
        <img src="{{ hero }}" alt="{{ title|default:'Course cover' }}" class="img-fluid" loading="lazy" decoding="async" />
      {% else %}
        {% responsive_picture hero alt=title|default:'Course cover' cls="img-fluid" %}
      {% endif %}
    {% endwith %}
    {% if hero_tag %}<span class="tags">{{ hero_tag }}</span>{% endif %}
    {% if video_url %}
    <div class="courses-play">
      <a class="play video-popup" href="{{ video_url }}">
        <i class="flaticon-play"></i>
        {% if video_label %}<span class="visually-hidden">{{ video_label }}</span>{% endif %}
      </a>
    </div>
    {% endif %}
  </div>

  {% if title %}<h2 class="title">{% render_string title %}</h2>{% endif %}
  {% if subtitle %}<p class="lead">{% render_string subtitle %}</p>{% endif %}

  <div class="courses-details-admin">
    {% with lead=instructors|first %}
    {% if lead %}
    <div class="admin-author">
      <div class="author-thumb">
        {% with avatar=lead.avatar_url|default:"" %}
          {% if avatar|slice:":4" == "http" %}
            <img src="{{ avatar }}" alt="{{ lead.name|default:'instructor' }}" class="rounded-circle" loading="lazy" decoding="async" />
          {% else %}
            {% responsive_picture avatar alt=lead.name|default:'instructor' cls="rounded-circle" %}
          {% endif %}
        {% endwith %}
      </div>
      <div class="author-content">
        {% if lead.profile_url %}<a class="name" href="{{ lead.profile_url }}">{{ lead.name }}</a>{% else %}<span class="name">{{ lead.name }}</span>{% endif %}
        {% if lead.role %}<span class="Enroll">{% render_string lead.role %}</span>{% endif %}
        {% if enrollment_label %}<span class="Enroll"><strong>{{ enrollment_label }}</strong></span>{% endif %}
      </div>
    </div>
    {% endif %}
    {% endwith %}

    <div class="admin-rating">
      {% if rating_value %}<span class="rating-count">{{ rating_value }}</span>{% endif %}
      <span class="rating-star"><span class="rating-bar" style="width: {{ rating_percentage }}%;"></span></span>
      {% if rating_count %}<span class="rating-text">({{ rating_count }})</span>{% endif %}
    </div>
  </div>

  <div class="courses-details-tab">
    <div class="details-tab-menu">
      <ul class="nav justify-content-center">
        {% if description_title %}<li><span class="active">{{ description_title }}</span></li>{% endif %}
        {% if bundle_title %}<li><span>{{ bundle_title }}</span></li>{% endif %}
        {% if curriculum_title %}<li><span>{{ curriculum_title }}</span></li>{% endif %}
        {% if instructors_title %}<li><span>{{ instructors_title }}</span></li>{% endif %}
        {% if reviews_title %}<li><span>{{ reviews_title }}</span></li>{% endif %}
      </ul>
    </div>

    <div class="details-tab-content">
      {% if description_blocks %}
      <div class="tab-description mb-5">
        {% for block in description_blocks %}
          <p>{% render_string block %}</p>
        {% endfor %}
      </div>
      {% endif %}

      {% if bundle_items %}
      <div class="tab-bundle mb-5">
        {% if bundle_title %}<h3 class="tab-title">{% render_string bundle_title %}</h3>{% endif %}
        <ul>
          {% for item in bundle_items %}
          <li>{% render_string item %}</li>
          {% endfor %}
        </ul>
      </div>
      {% endif %}

      {% if curriculum_sections %}
      <div class="tab-curriculum mb-5">
        {% if curriculum_title %}<h3 class="tab-title">{% render_string curriculum_title %}</h3>{% endif %}
        <div class="accordion" id="curriculumAccordion">
          {% for section in curriculum_sections %}
          <div class="accordion-item">
            <h2 class="accordion-header" id="heading-{{ forloop.counter }}">
              <button class="accordion-button {% if not forloop.first %}collapsed{% endif %}" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-{{ forloop.counter }}">
                {{ section.title }}
              </button>
            </h2>
            <div id="collapse-{{ forloop.counter }}" class="accordion-collapse collapse {% if forloop.first %}show{% endif %}" data-bs-parent="#curriculumAccordion">
              <div class="accordion-body">
                <ul class="list-unstyled">
                  {% for item in section.items %}
                  <li>{% render_string item %}</li>
                  {% endfor %}
                </ul>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      {% if instructors %}
      <div class="tab-instructors mb-5">
        {% if instructors_title %}<h3 class="tab-title">{% render_string instructors_title %}</h3>{% endif %}
        <div class="row g-4">
          {% for instructor in instructors %}
          <div class="col-md-6">
            <div class="admin-author">
              <div class="author-thumb">
                {% with avatar=instructor.avatar_url|default:"" %}
                  {% if avatar|slice:":4" == "http" %}
                    <img src="{{ avatar }}" alt="{{ instructor.name|default:'instructor' }}" class="rounded-circle" loading="lazy" decoding="async" />
                  {% else %}
                    {% responsive_picture avatar alt=instructor.name|default:'instructor' cls="rounded-circle" %}
                  {% endif %}
                {% endwith %}
              </div>
              <div class="author-content">
                {% if instructor.profile_url %}<a class="name" href="{{ instructor.profile_url }}">{{ instructor.name }}</a>{% else %}<span class="name">{{ instructor.name }}</span>{% endif %}
                {% if instructor.role %}<span class="Enroll">{% render_string instructor.role %}</span>{% endif %}
              </div>
            </div>
            {% if instructor.bio %}<p class="mt-3">{% render_string instructor.bio %}</p>{% endif %}
          </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      {% if reviews %}
      <div class="tab-reviews">
        {% if reviews_title %}<h3 class="tab-title">{% render_string reviews_title %}</h3>{% endif %}
        <div class="swiper-container">
          <div class="swiper-wrapper">
            {% for review in reviews %}
            <div class="single-review swiper-slide">
              <div class="review-author">
                <div class="author-thumb">
                  {% with avatar=review.avatar_url|default:"" %}
                    {% if avatar|slice:":4" == "http" %}
                      <img src="{{ avatar }}" alt="{{ review.author|default:'review author' }}" class="rounded-circle" loading="lazy" decoding="async" />
                    {% else %}
                      {% responsive_picture avatar alt=review.author|default:'review author' cls="rounded-circle" %}
                    {% endif %}
                  {% endwith %}
                </div>
                <div class="author-content">
                  <h4 class="name">{{ review.author }}</h4>
                  {% if review.location %}<span class="designation">{% render_string review.location %}</span>{% endif %}
                </div>
              </div>
              <p>{% render_string review.content %}</p>
            </div>
            {% endfor %}
          </div>
          <div class="swiper-pagination"></div>
        </div>
        {% if reviews_cta_label and reviews_cta_url %}
        <div class="reviews-btn text-center mt-4">
          <a class="btn btn-primary btn-hover-dark" href="{{ reviews_cta_url }}">{{ reviews_cta_label }}</a>
        </div>
        {% endif %}
      </div>
      {% endif %}
    </div>
  </div>
</div>
