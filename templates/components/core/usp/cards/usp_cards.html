{% load atelier_utils humanize static %}

<section class="usp-section">
  <div class="container">

    <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-3">
      <div class="usp-switch" role="tablist" aria-label="Choisir votre intention">
        {% for p in personas %}
          <button class="btn btn-outline-success {% if p.code == persona_default %}active{% endif %}"
                  role="tab"
                  data-persona-code="{{ p.code }}"
                  aria-selected="{% if p.code == persona_default %}true{% else %}false{% endif %}"
                  data-ev="persona_change">{{ p.label }}</button>
        {% endfor %}
      </div>
      <small class="text-muted ms-auto">Explorez les bénéfices selon votre objectif</small>
    </div>

    <div class="row row-cols-2 row-cols-lg-3 g-4" id="uspGrid">

      {% for it in pillars %}
        <div class="col">
          <div class="usp-card" data-ev="usp_hover" data-kind="pillar">
            <div class="usp-ico"><i class="{{ it.icon|default:'fas fa-star' }}"></i></div>
            <p class="usp-title">{{ it.title }}</p>
            {% if it.text %}<p class="usp-text">{{ it.text }}</p>{% endif %}
          </div>
        </div>
      {% endfor %}

      {% for code, arr in context_by_persona.items %}
        {% for it in arr %}
          <div class="col usp-context" data-persona="{{ code }}" {% if code != persona_default %}style="display:none"{% endif %}>
            <div class="usp-card" data-ev="usp_hover" data-kind="context" data-persona="{{ code }}">
              <div class="usp-ico"><i class="{{ it.icon|default:'fas fa-check' }}"></i></div>
              <p class="usp-title">{{ it.title }}</p>
              {% if it.text %}<p class="usp-text">{{ it.text }}</p>{% endif %}
            </div>
          </div>
        {% endfor %}
      {% endfor %}

    </div>
  </div>
</section>

<script>
(function(){
  var grid = document.getElementById('uspGrid');
  var btns = document.querySelectorAll('[data-persona-code]');
  function setPersona(code){
    btns.forEach(function(b){
      var active = (b.getAttribute('data-persona-code') === code);
      b.classList.toggle('active', active);
      b.setAttribute('aria-selected', active ? 'true' : 'false');
    });
    grid.querySelectorAll('.usp-context').forEach(function(col){
      col.style.display = (col.getAttribute('data-persona') === code) ? '' : 'none';
    });
  }
  btns.forEach(function(b){
    b.addEventListener('click', function(){ setPersona(this.getAttribute('data-persona-code')); });
  });
})();
</script>
