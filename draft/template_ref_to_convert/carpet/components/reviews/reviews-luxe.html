{% load static i18n %}

<!-- =============== REVIEWS – MUR UGC (NO JS LIB) =============== -->
<section class="rev rev-ugc {% if LANGUAGE_CODE == 'ar' %}rtl{% endif %}" dir="{% if LANGUAGE_CODE == 'ar' %}rtl{% else %}ltr{% endif %}">
  <div class="rev-inner">

    <!-- Header -->
    <header class="rev-head">
      <div class="rev-head-left">
        <p class="rev-sub">{% trans "Ce que disent nos clients" %}</p>
        <h2 class="rev-title">{% trans "Ils ont testé, ils ont adoré !" %}</h2>
      </div>

      <div class="rev-head-right">
        <span class="rev-badge">+1000 <small>{% trans "Clients" %}</small></span>
        <a class="rev-cta" href="#lead-form">{% trans "J'achète mon tapis" %} <i class="flaticon-up-right-arrow"></i></a>
      </div>
    </header>

    <!-- Track -->
    <div class="rev-wrap">
      <button class="rev-nav rev-prev" type="button" aria-label="{% trans 'Défiler vers la gauche' %}">
        <i class="flaticon-left-arrow"></i>
      </button>

      <div class="rev-track" role="list" tabindex="0" aria-label="{% trans 'Avis clients' %}">
        <!-- CARTE 1 -->
        <article class="rev-card" role="listitem">
          <img loading="lazy" decoding="async" width="640" height="480"
               src="{% static 'carpet/images/reviews/1.webp' %}"
               alt="{% trans 'Gros plan coussin mémoire — avis Amal Z.' %}">
          <div class="rev-body">
            <div class="rev-stars" aria-label="5/5">★★★★★</div>
            <h3 class="rev-h">{% trans "Un confort absolu !" %}</h3>
            <p class="rev-t">{% trans "Le coussin intégré est une merveille, doux et relaxant." %}</p>
            <p class="rev-meta">— Amal Z., {% trans "Casablanca" %} <span class="rev-v">✓</span></p>
          </div>
        </article>

        <!-- CARTE 2 -->
        <article class="rev-card" role="listitem">
          <img loading="lazy" decoding="async" width="640" height="480"
               src="{% static 'carpet/images/reviews/2.webp' %}"
               alt="{% trans 'Balcon au coucher du soleil — avis Idriss E.' %}">
          <div class="rev-body">
            <div class="rev-stars" aria-label="5/5">★★★★★</div>
            <h3 class="rev-h">{% trans "Je recommande vivement !" %}</h3>
            <p class="rev-t">{% trans "C'est doux, ça ne glisse pas, parfait pour la prière." %}</p>
            <p class="rev-meta">— Idriss E., {% trans "Tanger" %} <span class="rev-v">✓</span></p>
          </div>
        </article>

        <!-- CARTE 3 -->
        <article class="rev-card" role="listitem">
          <img loading="lazy" decoding="async" width="640" height="480"
               src="{% static 'carpet/images/reviews/3.webp' %}"
               alt="{% trans 'Salon — tapis Al-Raha — avis Lina H.' %}">
          <div class="rev-body">
            <div class="rev-stars" aria-label="5/5">★★★★★</div>
            <h3 class="rev-h">{% trans "Une expérience unique" %}</h3>
            <p class="rev-t">{% trans "On sent que c'est fait avec soin, la qualité est exceptionnelle." %}</p>
            <p class="rev-meta">— Lina H., {% trans "Agadir" %} <span class="rev-v">✓</span></p>
          </div>
        </article>

        <!-- CARTE 4 -->
        <article class="rev-card" role="listitem">
          <img loading="lazy" decoding="async" width="640" height="480"
               src="{% static 'carpet/images/reviews/4.webp' %}"
               alt="{% trans 'Tapis noir posé au sol — avis Omar N.' %}">
          <div class="rev-body">
            <div class="rev-stars" aria-label="5/5">★★★★★</div>
            <h3 class="rev-h">{% trans "Un vrai moment de paix" %}</h3>
            <p class="rev-t">{% trans "Le tapis est doux, ça apaise l'esprit rien qu'en le touchant." %}</p>
            <p class="rev-meta">— Omar N., {% trans "Fès" %} <span class="rev-v">✓</span></p>
          </div>
        </article>

        <!-- CARTE 5 -->
        <article class="rev-card" role="listitem">
          <img loading="lazy" decoding="async" width="640" height="480"
               src="{% static 'carpet/images/reviews/5.webp' %}"
               alt="{% trans 'Tapis et drap — avis Sara K.' %}">
          <div class="rev-body">
            <div class="rev-stars" aria-label="5/5">★★★★★</div>
            <h3 class="rev-h">{% trans "Top qualité !" %}</h3>
            <p class="rev-t">{% trans "Rien à dire, je l'utilise tous les jours." %}</p>
            <p class="rev-meta">— Sara K., {% trans "Marrakech" %} <span class="rev-v">✓</span></p>
          </div>
        </article>
      </div>

      <button class="rev-nav rev-next" type="button" aria-label="{% trans 'Défiler vers la droite' %}">
        <i class="flaticon-arrow-point-to-right"></i>
      </button>
    </div>

    <!-- CTA répété en mobile (sous la piste) -->
    <div class="rev-cta-bottom">
      <a class="rev-cta" href="#lead-form">{% trans "J'achète mon tapis" %} <i class="flaticon-up-right-arrow"></i></a>
    </div>
  </div>
</section>

<style>
/* ====== SCOPE & TOKENS ====== */
.rev-ugc{
  --rad:16px;
  --maxw:1120px;
  --surface: var(--surface, #111215);
  --surface2: var(--surface-2, #16181a);
  --text: var(--text, #f2f2f2);
  --muted: var(--muted, #b7b7bd);
  --gold: var(--gold, #d4af37);
  --bd: var(--bd, rgba(212,175,55,.22));
  --shadow: var(--shadow, 0 10px 30px rgba(0,0,0,.45));
  color: var(--text);
}
.rev-ugc.rtl{ direction:rtl; }

/* ====== CONTAINER ====== */
.rev-inner{ max-width:var(--maxw); margin:0 auto; padding: .25rem .75rem 0; }

/* ====== HEADER ====== */
.rev-head{
  display:flex; align-items:flex-end; justify-content:space-between; gap:1rem;
  margin: 0 0 .75rem;
}
.rev-head-left{ min-width:0; }
.rev-sub{
  color:var(--muted); letter-spacing:.18em; text-transform:uppercase;
  font-weight:700; font-size:.8rem; margin:0 0 .25rem;
}
.rev-title{ margin:0; font-size:clamp(1.25rem, 2.2vw, 1.8rem); line-height:1.25; }
.rev-head-right{ display:flex; gap:.6rem; align-items:center; flex-wrap:wrap; }
.rev-badge{
  display:inline-flex; align-items:center; gap:.35rem; padding:.35rem .6rem;
  border-radius:999px; border:1px solid var(--bd);
  background: color-mix(in srgb, var(--gold) 12%, transparent);
  color: var(--gold); font-weight:800;
}
.rev-badge small{ font-weight:600; color:var(--muted); }
.rev-cta{
  display:inline-flex; align-items:center; gap:.45rem;
  padding:.55rem .9rem; border-radius:999px; text-decoration:none; font-weight:800;
  background: var(--gold); color:#111;
  box-shadow: var(--shadow);
}
.rev-cta i{ line-height:1; }

/* ====== TRACK WRAP ====== */
.rev-wrap{ position:relative; }
.rev-track{
  position:relative; z-index:1;   /* s/t nav au-dessus */
  display:grid; grid-auto-flow:column; grid-auto-columns: 82%;
  gap:.9rem; overflow:auto; scroll-snap-type:x mandatory; -webkit-overflow-scrolling:touch;
  padding:.35rem .25rem 1rem;
  mask-image: linear-gradient(90deg, transparent 0, #000 20%, #000 80%, transparent 100%);
}
/* En RTL, on garde la piste en LTR pour simplifier le sens de scroll */
.rev-ugc.rtl .rev-track{ direction:ltr; }

@media (min-width: 768px){ .rev-track{ grid-auto-columns: 48%; } }
@media (min-width: 1100px){ .rev-track{ grid-auto-columns: 31%; } }

/* ====== CARD ====== */
.rev-card{
  scroll-snap-align:center; background:var(--surface); border:1px solid var(--bd);
  border-radius:var(--rad); overflow:hidden; box-shadow:var(--shadow);
  display:flex; flex-direction:column;
}
.rev-card img{
  width:100%; height:auto; display:block; aspect-ratio:4/3; object-fit:cover;
}
.rev-body{ padding:.85rem .95rem 1rem; }
.rev-stars{ color:var(--gold); letter-spacing:.06em; }
.rev-h{ margin:.2rem 0 .25rem; font-size:1.05rem; }
.rev-t{ margin:0 0 .45rem; color:var(--muted); }
.rev-meta{ margin:0; color:var(--muted); font-size:.92rem; }
.rev-v{ color:#2bd87f; font-weight:800; }

/* ====== NAV ====== */
.rev-nav{
  position:absolute; top:50%; transform:translateY(-50%);
  inline-size:42px; block-size:42px; display:grid; place-items:center;
  border-radius:999px; border:1px solid var(--bd);
  background: linear-gradient(180deg, #1c1c1c, #0e0e0e); color:var(--gold);
  box-shadow:0 8px 18px rgba(0,0,0,.35);
  z-index:3; /* au-dessus de la piste */
}
.rev-prev{ inset-inline-start: .25rem; }
.rev-next{ inset-inline-end: .25rem; }
.rev-nav:focus-visible{ outline:3px solid color-mix(in srgb, var(--gold) 30%, transparent); }

/* Inverser UNIQUEMENT le pictogramme en RTL (pour la cohérence visuelle) */
.rev-ugc.rtl .rev-prev i,
.rev-ugc.rtl .rev-next i { transform: scaleX(-1); }
.rev-nav i { transition: transform .15s ease; }

/* ====== CTA MOBILE ====== */
.rev-cta-bottom{ display:none; margin:.25rem 0 0; }
@media (max-width: 576px){
  .rev-cta-bottom{ display:block; text-align:center; }
  .rev-cta-bottom .rev-cta{ border-radius:12px; }
}

/* ====== RTL REFINEMENTS ====== */
.rev-ugc.rtl .rev-head{ flex-direction:row-reverse; }
.rev-ugc.rtl .rev-head-left{ text-align:right; }
</style>

<script>
/* ====== Track contrôlée + flèches ====== */
document.addEventListener('DOMContentLoaded', () => {
  const section = document.querySelector('.rev-ugc');
  if (!section) return;

  const track   = section.querySelector('.rev-track');
  const cards   = Array.from(track.querySelectorAll('.rev-card'));
  const btnPrev = section.querySelector('.rev-prev');
  const btnNext = section.querySelector('.rev-next');
  const isRTL   = section.classList.contains('rtl');

  function nearestIndex() {
    const rect = track.getBoundingClientRect();
    const centerX = rect.left + rect.width / 2;
    let best = 0, bestDist = Infinity;
    cards.forEach((c, i) => {
      const r = c.getBoundingClientRect();
      const cx = r.left + r.width / 2;
      const d = Math.abs(cx - centerX);
      if (d < bestDist) { bestDist = d; best = i; }
    });
    return best;
  }

  function go(delta) {
    const i = nearestIndex();
    const next = cards[Math.max(0, Math.min(cards.length - 1, i + delta))];
    if (next) next.scrollIntoView({behavior:'smooth', inline:'center', block:'nearest'});
  }

  /* Clicks (stopPropagation pour éviter le drag de la track) */
  btnPrev && btnPrev.addEventListener('click', (e) => {
    e.preventDefault(); e.stopPropagation();
    go(isRTL ? 1 : -1);
  });
  btnNext && btnNext.addEventListener('click', (e) => {
    e.preventDefault(); e.stopPropagation();
    go(isRTL ? -1 : 1);
  });

  /* Clavier : inversé en RTL */
  track.addEventListener('keydown', (e) => {
    if (!isRTL) {
      if (e.key === 'ArrowLeft')  { e.preventDefault(); go(-1); }
      if (e.key === 'ArrowRight') { e.preventDefault(); go(1);  }
    } else {
      if (e.key === 'ArrowLeft')  { e.preventDefault(); go(1);  }
      if (e.key === 'ArrowRight') { e.preventDefault(); go(-1); }
    }
  });

  /* Drag to scroll (desktop) */
  let isDown = false, startX = 0, startScroll = 0;
  track.addEventListener('pointerdown', (e) => {
    isDown = true; track.setPointerCapture(e.pointerId);
    startX = e.clientX; startScroll = track.scrollLeft;
  });
  track.addEventListener('pointermove', (e) => {
    if (!isDown) return;
    track.scrollLeft = startScroll - (e.clientX - startX);
  });
  ['pointerup','pointercancel','pointerleave'].forEach(ev => {
    track.addEventListener(ev, () => { isDown = false; });
  });
});
</script>
<!-- =============== /REVIEWS – MUR UGC =============== -->
