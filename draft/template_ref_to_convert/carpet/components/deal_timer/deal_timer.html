{% load i18n %}
{% get_current_language as LANGUAGE_CODE %}

<style>
/* ===== Deal Timer — Flex & Logical (FR=right / AR=left) ===== */
:root{
  --timer-accent : var(--ul-primary, #EF2853);   /* couleur marque (durée) */
  --timer-urgent : var(--ul-secondary, #FFA31A); /* < 1h */
  --timer-muted  : rgba(0,0,0,.68);
  --timer-soft   : rgba(239,40,83,.08);          /* léger halo desktop */
}

/* Conteneur : une ligne en flex, wrap si manque d’espace */
.deal-timer{
  display:flex; align-items:baseline; gap:.5rem 1rem; flex-wrap:wrap;
  padding:.375rem 0; min-height:40px;
  color:var(--black,#000); background:transparent; border:0;
  text-align:initial;                /* neutralise un éventuel text-align parent */
}

/* Bloc “offre” (gauche en FR, droite en AR, selon la direction du document) */
.deal-timer__left{
  display:flex; align-items:center; gap:.5rem; min-width:0;
}
.deal-timer__icon{ color:var(--timer-accent); width:18px; height:18px; display:grid; place-items:center; flex:0 0 18px; }
@media (max-width:360px){ .deal-timer__icon{ display:none; } }
.deal-timer__label{
  font-weight:600; line-height:1.25; font-size:clamp(13px,.94rem,15px);
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis; min-width:0;
}

/* Bloc “compteur” : poussé vers le bord de ligne via margin-inline-start:auto */
.deal-timer__right{
  margin-inline-start:auto;                 /* pousse à droite en LTR, à gauche en RTL */
  display:flex; align-items:baseline; gap:.5rem;
  white-space:nowrap;
  text-align:right;                         /* défaut LTR */
}
.deal-timer__hint{ color:var(--timer-muted); font-weight:500; }
.deal-timer__value{
  color:var(--timer-accent); font-weight:800; letter-spacing:.2px; line-height:1;
  font-variant-numeric:tabular-nums; unicode-bidi:isolate;
  padding:.125rem .375rem; border-radius:.5rem;
}
@media (min-width:576px){ .deal-timer__value{ background:var(--timer-soft); } }

/* États lus/posés par ton JS */
.deal-timer--warn .deal-timer__value{ color:var(--timer-urgent); background:rgba(255,163,26,.12); }
.deal-timer--expired{ opacity:.7; }

/* ===== RTL : le compteur passe à GAUCHE automatiquement */
</style>

<div id="{{ id|default:'deal-timer' }}"
     class="deal-timer"
     data-mode="{{ mode|default:'rolling' }}"
     data-deadline-iso="{{ deadline_iso|default_if_none:'' }}"
     data-rolling-hours="{{ rolling_hours|default:'24' }}"

     data-locale="{{ LANGUAGE_CODE }}"
     data-lp="{{ lp.slug|default:'' }}"
     data-variant="{{ variant.key|default:'' }}"
     data-trim="hm"                 {# FR/AR: heures + minutes seulement #}
     role="status" aria-live="polite">

  <!-- Infos promo -->
  <div class="deal-timer__left">
    <span class="deal-timer__icon" aria-hidden="true">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
        <circle cx="12" cy="13" r="8" stroke="currentColor" stroke-width="1.5"/>
        <path d="M12 9v5l3 1" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
      </svg>
    </span>
    <span class="deal-timer__label">
      {% if LANGUAGE_CODE == 'ar' %}
        {% trans 'عرض' %} -{{ price_ui.percent_text }} · {% trans 'توفّر' %} {{ price_ui.savings_text }}
      {% else %}
        {% trans 'Offre' %} -{{ price_ui.percent_text }} · {% trans 'vous économisez' %} {{ price_ui.savings_text }}
      {% endif %}
    </span>
  </div>

  <!-- Compteur -->
  <div class="deal-timer__right">
    <span class="deal-timer__hint">
      {% if LANGUAGE_CODE == 'ar' %}{% trans 'ينتهي خلال' %}{% else %}{% trans 'Reste' %}{% endif %}
    </span>
    <span class="deal-timer__value" data-role="value">--:--</span>
    <time class="d-none" data-role="deadline"></time>
  </div>
</div>
