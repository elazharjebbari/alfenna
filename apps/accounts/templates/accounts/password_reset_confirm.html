{% extends "partials/_auth_layout.html" %}
{% load i18n %}

{% block auth_title %}{% trans "Définir un nouveau mot de passe" %}{% endblock %}

{% block auth_form %}
  {% if not validlink %}
    <div class="alert error">{% trans "Ce lien de réinitialisation est invalide ou expiré." %}</div>
    <div class="meta-links">
      <a href="{% url 'accounts:password_reset' %}">{% trans "Demander un nouveau lien" %}</a>
    </div>
  {% else %}
    {% if form.non_field_errors %}
      <div class="alert error" role="alert">{{ form.non_field_errors|join:" " }}</div>
    {% endif %}

    <form class="auth-form" method="post" action="">
      {% csrf_token %}

      <div class="field">
        <label for="id_password1">{% trans "Nouveau mot de passe" %}</label>
        {% with field_errors=form.new_password1.errors %}
          <div class="password-field">
            <input id="id_password1"
                   name="new_password1"
                   type="password"
                   autocomplete="new-password"
                   required
                   aria-invalid="{{ field_errors|yesno:'true,false' }}"
                   {% if field_errors %}aria-describedby="err_id_password1"{% endif %}>
            <button type="button"
                    class="pw-toggle"
                    aria-controls="id_password1"
                    aria-label="{% trans 'Afficher le mot de passe' %}"
                    data-label-hide="{% trans 'Masquer le mot de passe' %}">👁</button>
          </div>
          <small class="caps-hint">{% trans "Verr Maj activée" %}</small>
          {% if field_errors %}
            <div class="alert error field-error" id="err_id_password1">{{ field_errors|join:" " }}</div>
          {% endif %}
        {% endwith %}
      </div>

      <div class="field">
        <label for="id_password2">{% trans "Confirmer le mot de passe" %}</label>
        {% with field_errors=form.new_password2.errors %}
          <div class="password-field">
            <input id="id_password2"
                   name="new_password2"
                   type="password"
                   autocomplete="new-password"
                   required
                   aria-invalid="{{ field_errors|yesno:'true,false' }}"
                   {% if field_errors %}aria-describedby="err_id_password2"{% endif %}>
            <button type="button"
                    class="pw-toggle"
                    aria-controls="id_password2"
                    aria-label="{% trans 'Afficher le mot de passe' %}"
                    data-label-hide="{% trans 'Masquer le mot de passe' %}">👁</button>
          </div>
          <small class="caps-hint">{% trans "Verr Maj activée" %}</small>
          {% if field_errors %}
            <div class="alert error field-error" id="err_id_password2">{{ field_errors|join:" " }}</div>
          {% endif %}
        {% endwith %}
      </div>

      <div class="auth-actions">
        <button class="btn-primary" type="submit">{% trans "Enregistrer" %}</button>
      </div>
    </form>
  {% endif %}
{% endblock %}
